<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Escape Game Project - 3EII PJM 2022: The uptime mock example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Escape Game Project - 3EII PJM 2022
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__c_mocka_cmocka-1_81_85_example_mock_uptime__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The uptime mock example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a very simple example to explain the mocking feature of cmocka. It implement the 'uptime' unix command in a very simple way to demonstrate how to test the time calculation.</p>
<p>The problem with testing the uptime command is that /proc/uptime constantly ticks. The result is random whenever you call the test. To actually test it we need to make sure that we work with fixed values. The mocking features of cmocka allows us to test it anyway!</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Source files</h1>
<ul>
<li><em><a class="el" href="proc__uptime_8c.html">proc_uptime.c</a></em>: This implements the <code><a class="el" href="proc__uptime_8c.html#aecc7169d0162d4130898938d684e3eae">uptime()</a></code> function reading and parsing the /proc/uptime file.</li>
<li><em><a class="el" href="uptime_8c.html">uptime.c</a></em>: This is the actual uptime implementation, it calls <code>calc_uptime()</code> to get a human readable string representation of the uptime. This function calls <code><a class="el" href="proc__uptime_8c.html#aecc7169d0162d4130898938d684e3eae">uptime()</a></code> from <a class="el" href="proc__uptime_8c.html">proc_uptime.c</a>.</li>
<li><em><a class="el" href="test__uptime_8c.html">test_uptime.c</a></em>: This is the test with the mocking function for <a class="el" href="proc__uptime_8c.html#aecc7169d0162d4130898938d684e3eae">uptime()</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Linking magic</h1>
<p>The test is linked using: </p><pre class="fragment">ld --wrap=uptime
</pre><p>This replaces the orginal <code><a class="el" href="proc__uptime_8c.html#aecc7169d0162d4130898938d684e3eae">uptime()</a></code> function which reads from <code>/proc/uptime</code> with the mock function we implemented for testing <code>calc_uptime()</code>.</p>
<p>The mock function we implemented has a special name. It is called <code><a class="el" href="test__uptime_8c.html#a4f9f6bbb9cde6c33775253e777323acc">__wrap_uptime()</a></code>. All the symbols you want to mock (or replace) need to start with the prefix <code>__wrap_</code>. So <code>ld --wrap=uptime</code> will rename the orignal <code><a class="el" href="proc__uptime_8c.html#aecc7169d0162d4130898938d684e3eae">uptime()</a></code> function to <code>__real_uptime()</code>. This means you can still reach the original function using that name and call it e.g. from the wrap function. The symbol <code>uptime</code> will be bound to <code>__wrap_uptime</code>.</p>
<p>You can find more details in the manpage: <code>man ld</code></p>
<h1><a class="anchor" id="autotoc_md6"></a>
The uptime test</h1>
<p>The code should be easy to understand. If you have a hard time following, there are two ways to understand how things work.</p>
<p>You can find out details about symbol binding using: </p><pre class="fragment">LD_DEBUG=symbols ./example/uptime/uptime
LD_DEBUG=symbols ./example/uptime/test_uptime
</pre><p>You can also use a debugger to step through the code!</p>
<p>Have fun! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
